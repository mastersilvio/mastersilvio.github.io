// Language switcher button functionality
(function(){
  var button = document.getElementById('language-button');
  if (!button) return;

  // Get current page language and translation key from data attributes
  var currentLang = document.documentElement.getAttribute('data-lang') || 'pt';
  var translationKey = document.documentElement.getAttribute('data-translation-key');

  // Use global translation mappings (generated by Jekyll in translation-mappings.html)
  var urlMappings = window.translationMappings || {};

  function getAlternateUrl(currentLang, translationKey) {
    var targetLang = currentLang === 'pt' ? 'en' : 'pt';

    // Check if we have a mapping for this translation key
    if (translationKey && urlMappings[translationKey]) {
      var alternateUrl = urlMappings[translationKey][targetLang];
      if (alternateUrl) {
        return alternateUrl;
      }
    }

    // Fallback: return to home page of target language
    return targetLang === 'en' ? '/en/' : '/';
  }

  function updateButton() {
    // Show flag of the language we can switch TO, not current language
    var targetLang = currentLang === 'pt' ? 'en' : 'pt';
    button.textContent = targetLang === 'en' ? 'ðŸ‡ºðŸ‡¸' : 'ðŸ‡§ðŸ‡·';
    button.setAttribute('aria-label', targetLang === 'en' ? 'Switch to English' : 'Mudar para PortuguÃªs');
    button.setAttribute('title', targetLang === 'en' ? 'Switch to English' : 'Mudar para PortuguÃªs');
  }

  // Check if translation exists
  function checkTranslationExists() {
    // If no translation key, no translation available
    if (!translationKey) {
      return false;
    }

    // Check if mapping exists for this translation key
    if (!urlMappings[translationKey]) {
      return false;
    }

    // Check if target language URL exists in mapping
    var targetLang = currentLang === 'pt' ? 'en' : 'pt';
    return !!urlMappings[translationKey][targetLang];
  }

  // Check if translation exists and initialize button
  if (!checkTranslationExists()) {
    // Hide language button if translation doesn't exist
    button.style.display = 'none';
    return;
  }

  // Show button and set up click handler
  updateButton();

  button.addEventListener('click', function(){
    var targetLang = currentLang === 'pt' ? 'en' : 'pt';
    var alternateUrl = getAlternateUrl(currentLang, translationKey);

    // Save language preference
    try {
      localStorage.setItem('lang', targetLang);
    } catch (e) {
      console.error('Error saving language preference:', e);
    }

    // Navigate to alternate language version
    window.location.href = alternateUrl;
  });
})();
