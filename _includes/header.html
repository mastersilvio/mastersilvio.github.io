<header>
  <div style="position: relative;">
    <a href="{{ "/" | prepend: site.baseurl | replace: '//', '/' }}">
    {% assign owner_first_name = site.owner | split: " " %}
    <h1>{{ owner_first_name[0] | downcase }}@home:~$</h1>
    </a>
    <div class="header-links">
      {% include links.html %}
    </div>

    {% assign current_lang = page.lang | default: 'pt' %}
    {% if current_lang == 'pt' %}
      {% assign target_lang = 'en' %}
    {% else %}
      {% assign target_lang = 'pt' %}
    {% endif %}

    {% assign counterpart_url = nil %}
    {% if page.translation_key %}
      {% if page.date %}
        {% for p in site.posts %}
          {% if p.translation_key == page.translation_key and p.lang == target_lang %}
            {% assign counterpart_url = p.url %}
          {% endif %}
        {% endfor %}
      {% else %}
        {% for pg in site.pages %}
          {% if pg.translation_key == page.translation_key and pg.lang == target_lang %}
            {% assign counterpart_url = pg.url %}
          {% endif %}
        {% endfor %}
      {% endif %}
    {% endif %}

    {% if counterpart_url == nil %}
      {% if target_lang == 'en' %}
        {% assign counterpart_url = '/en/' %}
      {% else %}
        {% assign counterpart_url = '/' %}
      {% endif %}
    {% endif %}

    <div class="lang-toggle">
      <input type="checkbox" id="lang-switch" {% if current_lang == 'en' %}checked{% endif %} aria-label="Switch language">
      <label for="lang-switch">
        <span class="lang-option lang-pt">PT</span>
        <span class="switch-slider"></span>
        <span class="lang-option lang-en">EN</span>
      </label>
    </div>

    <script>
      (function(){
        var el = document.getElementById('lang-switch');
        if (!el) return;
        el.addEventListener('change', function(){
          var href = '{{ counterpart_url | prepend: site.baseurl | replace: "//", "/" }}';
          window.location.href = href;
        });
      })();
    </script>
  </div>
</header>