---
import Layout from '@/layouts/Layout.astro';
import { SITE } from '@/config';
import Breadcrumbs from '@/components/Breadcrumbs.svelte';
import I18nLabel from '@/components/I18nLabel.astro';
import { getCollection } from 'astro:content';
import { getBreadcrumbSchema } from '@/lib/schemas';

const schema = getBreadcrumbSchema([
  { name: 'Projetos', url: new URL('/projects', Astro.site).toString() },
]);

const projects = (await getCollection('projects')).sort(
  (a, b) => a.data.order - b.data.order
);
---

<Layout
  title={`Projetos | ${SITE.author}`}
  description={`Projetos desenvolvidos por ${SITE.author}.`}
  schema={schema}
>
  <Breadcrumbs items={[{ name: 'Projetos', href: '/projects' }]} />

  <div class="mb-10 sm:mb-12">
    <I18nLabel
      k="projects"
      tag="h1"
      class="text-4xl font-black tracking-tight text-foreground sm:text-5xl"
    />
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 max-w-4xl">
    {
      projects.map((project) => {
        const href = project.data.directLink
          ? project.data.link
          : `/projects/${project.id}`;
        const isExternal = !!project.data.directLink;

        return (
          <a
            href={href}
            target={isExternal ? '_blank' : undefined}
            rel={isExternal ? 'noopener noreferrer' : undefined}
            class="group flex flex-col gap-4 p-6 rounded-2xl border border-border bg-secondary hover:border-primary/50 hover:bg-accent transition-all no-underline"
          >
            <div class="flex items-start justify-between gap-3">
              <div class="flex items-center gap-3 min-w-0">
                {project.data.image && (
                  <img
                    src={project.data.image}
                    alt={`${project.data.title} logo`}
                    width="40"
                    height="40"
                    class="w-10 h-10 rounded-lg object-contain flex-shrink-0 bg-background border border-border p-0.5"
                    onerror="this.style.display='none'"
                  />
                )}
                <h2 class="text-xl font-bold text-foreground group-hover:text-primary transition-colors leading-tight">
                  {project.data.title}
                </h2>
              </div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="flex-shrink-0 text-muted-foreground group-hover:text-primary transition-colors mt-0.5"
              >
                <path d="M7 7h10v10" />
                <path d="M7 17 17 7" />
              </svg>
            </div>

            {project.data.descriptions ? (
              <>
                <p data-i18n="pt" class="text-sm text-muted-foreground leading-relaxed flex-1">
                  {project.data.descriptions.pt ?? project.data.description}
                </p>
                <p data-i18n="en" class="text-sm text-muted-foreground leading-relaxed flex-1">
                  {project.data.descriptions.en ?? project.data.description}
                </p>
                <p data-i18n="es" class="text-sm text-muted-foreground leading-relaxed flex-1">
                  {project.data.descriptions.es ?? project.data.description}
                </p>
              </>
            ) : (
              <p class="text-sm text-muted-foreground leading-relaxed flex-1">
                {project.data.description}
              </p>
            )}

            {project.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2">
                {project.data.tags.map((tag) => (
                  <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-background border border-border text-muted-foreground">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </a>
        );
      })
    }
  </div>
</Layout>
